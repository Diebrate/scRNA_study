res1$summary.fitted.values[,"mean"]
res1$summary.fitted.values[,"mean"]*E
pennLC.sf$counts
penn_res1 <- pennLC.sf %>% mutate(pred=res1$summary.fitted.values[,"mean"] * E,
sd=res1$summary.fitted.values[,"sd"] * E^2)
tm_shape(penn_res1) +
tm_polygons("pred")
tm_shape(penn_res1) +
tm_polygons("sd")
res1$summary.fitted.values[,"mean"] * E
penn_res1 <- pennLC.sf %>% mutate(pred=res1$summary.fitted.values[,"mean"],
sd=res1$summary.fitted.values[,"sd"])
tm_shape(penn_res1) +
tm_polygons("pred")
tm_shape(penn_res1) +
tm_polygons("sd")
df2 <- matrix(nrow=100, ncol=nd)
for(i in 1:100){
b0 <- rnorm(n=1, mean=0, sd=100)
b1 <- rnorm(n=1, mean=0, sd=100)
tau_nu <- rgamma(n=1, shape=0.1, scale=0.1)
tau_mu <- rgamma(n=1, shape=0.1, scale=0.1)
mu <- mvrnorm(n=1, mu=rep(0, nd), Sigma=diag(rep(1, nd)))
log_theta <- b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/tau_nu)
y <- rpois(n=nd, lambda=exp(log_theta) * E)
df2[i, ] <- y
}
# This is not a good prior since tau_mu tends to yield extreme log_theta.
# Many draws are infinitely large.
df2 <- data.frame(df2)
colnames(df2) <- pennLC.sf$county
head(df2)
hist(df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
log_theta
tau_mu
get_mu(tau_mu, W, d$x, mu)
b1 * pennLC.sf$smoking
b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu)
b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/tau_nu)
df2 <- matrix(nrow=100, ncol=nd)
for(i in 1:100){
b0 <- rnorm(n=1, mean=0, sd=100)
b1 <- rnorm(n=1, mean=0, sd=100)
tau_nu <- rgamma(n=1, shape=0.1, scale=0.1)
tau_mu <- rgamma(n=1, shape=0.1, rate=0.1)
mu <- mvrnorm(n=1, mu=rep(0, nd), Sigma=diag(rep(1, nd)))
log_theta <- b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/tau_nu)
y <- rpois(n=nd, lambda=exp(log_theta) * E)
df2[i, ] <- y
}
# This is not a good prior since tau_mu tends to yield extreme log_theta.
# Many draws are infinitely large.
df2 <- data.frame(df2)
colnames(df2) <- pennLC.sf$county
head(df2)
hist(df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
df2 <- matrix(nrow=100, ncol=nd)
for(i in 1:100){
b0 <- rnorm(n=1, mean=0, sd=100)
b1 <- rnorm(n=1, mean=0, sd=100)
tau_nu <- rgamma(n=1, shape=0.1, scale=0.1)
tau_mu <- rgamma(n=1, shape=0.1, scale=0.1)
mu <- mvrnorm(n=1, mu=rep(0, nd), Sigma=diag(rep(1, nd)))
log_theta <- b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/tau_nu)
y <- rpois(n=nd, lambda=exp(log_theta) * E)
df2[i, ] <- y
}
# This is not a good prior since tau_mu tends to yield extreme log_theta.
# Many draws are infinitely large.
df2 <- data.frame(df2)
colnames(df2) <- pennLC.sf$county
head(df2)
hist(df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
E
res1
res1$summary.fixed
res1$Q
res1$summary.lincomb
res1$summary.hyperpar
res1$summary.random
pp_df1 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res1$summary.fixed[1, "mean"], sd=res1$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res1$summary.fixed[2, "mean"], sd=res1$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res1$summary.random$re_u[, "mean"],
sd=res1$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res1$summary.random$re_v[, "mean"],
sd=res1$summary.random$re_v[, "sd"])
pp_df1[i, ] <- bo + b1 * pennLC.sf$smoking + u + v
}
pp_df1 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res1$summary.fixed[1, "mean"], sd=res1$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res1$summary.fixed[2, "mean"], sd=res1$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res1$summary.random$re_u[, "mean"],
sd=res1$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res1$summary.random$re_v[, "mean"],
sd=res1$summary.random$re_v[, "sd"])
pp_df1[i, ] <- b0 + b1 * pennLC.sf$smoking + u + v
}
pp_df1 <- data.frame(pp_df1)
colnames(pp_df1) <- pennLC.sf$county
head(pp_df1)
hist(pp_df1$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
pp_df1 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res1$summary.fixed[1, "mean"], sd=res1$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res1$summary.fixed[2, "mean"], sd=res1$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res1$summary.random$re_u[, "mean"],
sd=res1$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res1$summary.random$re_v[, "mean"],
sd=res1$summary.random$re_v[, "sd"])
pp_df1[i, ] <- exp(b0 + b1 * pennLC.sf$smoking + u + v0) * E
}
pp_df1 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res1$summary.fixed[1, "mean"], sd=res1$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res1$summary.fixed[2, "mean"], sd=res1$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res1$summary.random$re_u[, "mean"],
sd=res1$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res1$summary.random$re_v[, "mean"],
sd=res1$summary.random$re_v[, "sd"])
pp_df1[i, ] <- exp(b0 + b1 * pennLC.sf$smoking + u + v) * E
}
pp_df1 <- data.frame(pp_df1)
colnames(pp_df1) <- pennLC.sf$county
head(pp_df1)
hist(pp_df1$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
pp_df1 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res1$summary.fixed[1, "mean"], sd=res1$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res1$summary.fixed[2, "mean"], sd=res1$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res1$summary.random$re_u[, "mean"],
sd=res1$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res1$summary.random$re_v[, "mean"],
sd=res1$summary.random$re_v[, "sd"])
pp_df1[i, ] <- rpois(n=nd, lambda=exp(b0 + b1 * pennLC.sf$smoking + u + v) * E)
}
pp_df1 <- data.frame(pp_df1)
colnames(pp_df1) <- pennLC.sf$county
head(pp_df1)
hist(pp_df1$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
pp_df1 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res1$summary.fixed[1, "mean"], sd=res1$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res1$summary.fixed[2, "mean"], sd=res1$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res1$summary.random$re_u[, "mean"],
sd=res1$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res1$summary.random$re_v[, "mean"],
sd=res1$summary.random$re_v[, "sd"])
pp_df1[i, ] <- rpois(n=nd, lambda=exp(b0 + b1 * pennLC.sf$smoking + u + v) * E)
}
pp_df1 <- data.frame(pp_df1)
colnames(pp_df1) <- pennLC.sf$county
head(pp_df1)
hist(pp_df1$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(pp_df1$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(pp_df1$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(pp_df1$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(pp_df1$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(pp_df1$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
pp_df2 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res2$summary.fixed[1, "mean"], sd=res2$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res2$summary.fixed[2, "mean"], sd=res2$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res2$summary.random$re_u[, "mean"],
sd=res2$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res2$summary.random$re_v[, "mean"],
sd=res2$summary.random$re_v[, "sd"])
pp_df2[2, ] <- rpois(n=nd, lambda=exp(b0 + b1 * pennLC.sf$smoking + u + v) * E)
}
pp_df2 <- data.frame(pp_df2)
colnames(pp_df2) <- pennLC.sf$county
head(pp_df2)
hist(pp_df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(pp_df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(pp_df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(pp_df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(pp_df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(pp_df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
pp_df3 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res3$summary.fixed[1, "mean"], sd=res3$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res3$summary.fixed[2, "mean"], sd=res3$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res3$summary.random$re_u[, "mean"],
sd=res3$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res3$summary.random$re_v[, "mean"],
sd=res3$summary.random$re_v[, "sd"])
pp_df3[i, ] <- rpois(n=nd, lambda=exp(b0 + b1 * pennLC.sf$smoking + u + v) * E)
}
pp_df3 <- data.frame(pp_df3)
colnames(pp_df3) <- pennLC.sf$county
head(pp_df3)
hist(pp_df3$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(pp_df3$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(pp_df3$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(pp_df3$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(pp_df3$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(pp_df3$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
pp_df2 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res2$summary.fixed[1, "mean"], sd=res2$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res2$summary.fixed[2, "mean"], sd=res2$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res2$summary.random$re_u[, "mean"],
sd=res2$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res2$summary.random$re_v[, "mean"],
sd=res2$summary.random$re_v[, "sd"])
pp_df2[2, ] <- rpois(n=nd, lambda=exp(b0 + b1 * pennLC.sf$smoking + u + v) * E)
}
pp_df2 <- data.frame(pp_df2)
colnames(pp_df2) <- pennLC.sf$county
head(pp_df2)
hist(pp_df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(pp_df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(pp_df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(pp_df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(pp_df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(pp_df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
res2$summary.fixe
res1$summary.fixe
res1$summary.random
res2$summary.random
res2$summary.random$re_v[, "mean"]
res1$summary.random$re_v[, "mean"]
pp_df2 <- matrix(0, ncol=nd, nrow=100)
for(i in 1:100){
b0 <- rnorm(n=1, mean=res2$summary.fixed[1, "mean"], sd=res2$summary.fixed[1, "sd"])
b1 <- rnorm(n=1, mean=res2$summary.fixed[2, "mean"], sd=res2$summary.fixed[2, "sd"])
u <- rnorm(n=nd,
mean=res2$summary.random$re_u[, "mean"],
sd=res2$summary.random$re_u[, "sd"])
v <- rnorm(n=nd,
mean=res2$summary.random$re_v[, "mean"],
sd=res2$summary.random$re_v[, "sd"])
pp_df2[i, ] <- rpois(n=nd, lambda=exp(b0 + b1 * pennLC.sf$smoking + u + v) * E)
}
pp_df2 <- data.frame(pp_df2)
colnames(pp_df2) <- pennLC.sf$county
head(pp_df2)
hist(pp_df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(pp_df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(pp_df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(pp_df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(pp_df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(pp_df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
tmap_mode("plot")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df1[1,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df1[2,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df1[3,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df1[4,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
tmap_mode("plot")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df2[1,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df2[2,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df2[3,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df2[4,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
tmap_mode("plot")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df3[1,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df3[2,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df3[3,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
pennLC_temp <- pennLC.sf %>% mutate(ppdraw=c(t(pp_df3[4,])))
tm_shape(pennLC_temp) +
tm_polygons("ppdraw")
df1 <- matrix(nrow=100, ncol=nd)
for(i in 1:100){
b0 <- rnorm(n=1, mean=0, sd=1)
b1 <- rnorm(n=1, mean=0, sd=1)
tau_nu <- rgamma(n=1, shape=1, scale=1)
tau_mu <- rgamma(n=1, shape=1, scale=1)
mu <- mvrnorm(n=1, mu=rep(0, nd), Sigma=diag(rep(1, nd)))
log_theta <- b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/sqrt(tau_nu))
y <- rpois(n=nd, lambda=exp(log_theta) * E)
df1[i, ] <- y
}
df1 <- data.frame(df1)
colnames(df1) <- pennLC.sf$county
head(df1)
# the largest 20% are trimmed to avoid extreme values
v <- sort(df1$centre, TRUE)[20:100]
hist(v[v <= 10000], main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
v <- sort(df1$monroe, TRUE)[20:100]
hist(v[v <= 10000], main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
v <- sort(df1$westmoreland)[20:100]
hist(v[v <= 10000], main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
v <- sort(df1$lebanon, TRUE)[20:100]
hist(v[v <= 10000], main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
v <- sort(df1$beaver, TRUE)[20:100]
hist(v[v <= 10000], main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
v <- sort(df1$erie, TRUE)[20:100]
hist(v[v <= 10000], main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
df2 <- matrix(nrow=100, ncol=nd)
for(i in 1:100){
b0 <- rnorm(n=1, mean=0, sd=100)
b1 <- rnorm(n=1, mean=0, sd=100)
tau_nu <- rgamma(n=1, shape=0.1, scale=0.1)
tau_mu <- rgamma(n=1, shape=0.1, scale=0.1)
mu <- mvrnorm(n=1, mu=rep(0, nd), Sigma=diag(rep(1, nd)))
log_theta <- b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/sqrt(tau_nu))
y <- rpois(n=nd, lambda=exp(log_theta) * E)
df2[i, ] <- y
}
# This is not a good prior since tau_mu tends to yield extreme log_theta.
# Many draws are infinitely large.
df2 <- data.frame(df2)
colnames(df2) <- pennLC.sf$county
head(df2)
hist(df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
df1 <- matrix(nrow=100, ncol=nd)
for(i in 1:100){
b0 <- rnorm(n=1, mean=0, sd=1)
b1 <- rnorm(n=1, mean=0, sd=1)
tau_nu <- rgamma(n=1, shape=1, scale=1)
tau_mu <- rgamma(n=1, shape=1, scale=1)
mu <- mvrnorm(n=1, mu=rep(0, nd), Sigma=diag(rep(1, nd)))
log_theta <- b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/tau_nu)
y <- rpois(n=nd, lambda=exp(log_theta) * E)
df1[i, ] <- y
}
df1 <- data.frame(df1)
colnames(df1) <- pennLC.sf$county
head(df1)
# the largest 20% are trimmed to avoid extreme values
v <- sort(df1$centre, TRUE)[20:100]
hist(v[v <= 10000], main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
v <- sort(df1$monroe, TRUE)[20:100]
hist(v[v <= 10000], main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
v <- sort(df1$westmoreland)[20:100]
hist(v[v <= 10000], main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
v <- sort(df1$lebanon, TRUE)[20:100]
hist(v[v <= 10000], main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
v <- sort(df1$beaver, TRUE)[20:100]
hist(v[v <= 10000], main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
v <- sort(df1$erie, TRUE)[20:100]
hist(v[v <= 10000], main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
df2 <- matrix(nrow=100, ncol=nd)
for(i in 1:100){
b0 <- rnorm(n=1, mean=0, sd=100)
b1 <- rnorm(n=1, mean=0, sd=100)
tau_nu <- rgamma(n=1, shape=0.1, scale=0.1)
tau_mu <- rgamma(n=1, shape=0.1, scale=0.1)
mu <- mvrnorm(n=1, mu=rep(0, nd), Sigma=diag(rep(1, nd)))
log_theta <- b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu) + rnorm(n=nd, mean=0, sd=1/tau_nu)
y <- rpois(n=nd, lambda=exp(log_theta) * E)
df2[i, ] <- y
}
# This is not a good prior since tau_mu tends to yield extreme log_theta.
# Many draws are infinitely large.
df2 <- data.frame(df2)
colnames(df2) <- pennLC.sf$county
head(df2)
hist(df2$centre, main='centre', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='centre'))$counts)
hist(df2$monroe, main='monroe', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='monroe'))$counts)
hist(df2$westmoreland, main='westmoreland', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='westmoreland'))$counts)
hist(df2$lebanon, main='lebanon', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='lebanon'))$counts)
hist(df2$beaver, main='beaver', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='beaver'))$counts)
hist(df2$erie, main='erie', xlab='y')
abline(v=(pennLC.sf %>% filter(county=='erie'))$counts)
rnorm(n=nd, mean=0, sd=1/tau_nu)
rnorm(n=nd, mean=0, sd=1/\sqrt(tau_nu))
rnorm(n=nd, mean=0, sd=1/sqrt(tau_nu))
b0 + b1 * pennLC.sf$smoking +
get_mu(tau_mu, W, d$x, mu)
rgamma(n=1, shape=0.1, scale=0.1)
rgamma(n=1, shape=0.1, scale=0.1)
rgamma(n=1, shape=0.1, scale=0.1)
rgamma(n=1, shape=0.1, scale=0.1)
rgamma(n=1, shape=0.1, scale=0.1)
rgamma(n=1, shape=0.1, scale=0.1)
rgamma(n=1, shape=0.1, scale=0.1)
source('~/GitHub/scRNA_study/test/wbs_cost.R')
